<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daegon Awards</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --gold: #c9a44c;
  --gold-dark: #b89440;
  --black: #000000;
  --dark: #1a1a1a;
  --gray: #666666;
  --light-gray: #f5f5f5;
  --white: #ffffff;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: var(--white);
  color: var(--dark);
  line-height: 1.6;
}

/* Header Styles */
header {
  background-color: var(--white);
  box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
  position: sticky;
  top: 0;
  z-index: 1000;
  border-bottom: 3px solid var(--gold);
}

.header-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  display: flex;
  align-items: center;
  gap: 15px;
}

.logo-icon {
  color: var(--gold);
  font-size: 32px;
}

.logo h1 {
  font-family: 'Times New Roman', serif;
  font-size: 32px;
  letter-spacing: 3px;
  color: var(--black);
  margin: 0;
}

nav ul {
  display: flex;
  list-style: none;
  gap: 25px;
}

nav a {
  text-decoration: none;
  color: var(--black);
  font-weight: 600;
  font-size: 16px;
  transition: color 0.3s;
  position: relative;
  padding: 5px 0;
}

nav a:hover {
  color: var(--gold);
}

nav a.active {
  color: var(--gold);
}

nav a.active::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background-color: var(--gold);
}

/* Main Container */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 20px;
  min-height: calc(100vh - 200px);
}

.hidden {
  display: none !important;
}

/* Home Page */
.home-header {
  text-align: center;
  margin-bottom: 50px;
}

.home-header h2 {
  font-size: 36px;
  margin-bottom: 15px;
  color: var(--black);
  font-family: 'Times New Roman', serif;
}

.home-header p {
  font-size: 18px;
  color: var(--gray);
  max-width: 700px;
  margin: 0 auto;
}

.editions-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 40px;
}

.edition-card {
  background-color: var(--white);
  border: 2px solid var(--gold);
  border-radius: 12px;
  padding: 30px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  position: relative;
  overflow: hidden;
}

.edition-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 15px 30px rgba(201, 164, 76, 0.15);
  background-color: var(--gold);
  color: var(--white);
}

.edition-card:hover .edition-year {
  color: var(--white);
}

.edition-year {
  font-size: 36px;
  font-weight: 700;
  color: var(--gold);
  margin-bottom: 5px;
  font-family: 'Times New Roman', serif;
  transition: color 0.3s;
}

.edition-label {
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 2px;
  opacity: 0.8;
}

/* Edition Page */
.edition-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
  padding-bottom: 20px;
  border-bottom: 2px solid var(--gold);
}

.edition-header h2 {
  font-size: 36px;
  color: var(--black);
  font-family: 'Times New Roman', serif;
}

.back-button {
  background-color: var(--gold);
  color: var(--white);
  border: none;
  padding: 12px 25px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: background-color 0.3s;
}

.back-button:hover {
  background-color: var(--gold-dark);
}

/* Categories */
.category-container {
  margin-bottom: 50px;
  background-color: var(--white);
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
}

.category-header {
  background-color: var(--gold);
  color: var(--white);
  padding: 20px;
}

.category-header h3 {
  font-size: 24px;
  font-family: 'Times New Roman', serif;
  margin: 0;
}

.nominees-list {
  padding: 20px;
}

.nominee-item {
  display: flex;
  align-items: center;
  padding: 15px;
  border-bottom: 1px solid var(--light-gray);
  transition: background-color 0.2s;
}

.nominee-item:last-child {
  border-bottom: none;
}

.nominee-item:hover {
  background-color: rgba(201, 164, 76, 0.05);
}

.winner {
  background-color: rgba(201, 164, 76, 0.1);
  border-left: 4px solid var(--gold);
}

.nominee-image {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--gold);
  margin-right: 20px;
  flex-shrink: 0;
}

.nominee-info {
  flex-grow: 1;
}

.nominee-name {
  font-weight: 600;
  font-size: 18px;
  margin-bottom: 5px;
  color: var(--black);
}

.nominee-work {
  color: var(--gray);
  font-size: 16px;
  margin-bottom: 5px;
}

.nominee-feature {
  color: var(--gray);
  font-size: 14px;
  font-style: italic;
}

.nominee-status {
  margin-left: 15px;
}

.status-badge {
  padding: 6px 15px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
}

.winner-badge {
  background-color: var(--gold);
  color: var(--white);
}

.nominated-badge {
  background-color: var(--light-gray);
  color: var(--gray);
}

/* Artist Page */
.artist-header {
  display: flex;
  align-items: center;
  gap: 30px;
  margin-bottom: 40px;
  padding-bottom: 30px;
  border-bottom: 2px solid var(--gold);
}

.artist-image {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid var(--gold);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.artist-details h2 {
  font-size: 36px;
  margin-bottom: 10px;
  color: var(--black);
  font-family: 'Times New Roman', serif;
}

.artist-stats {
  display: flex;
  gap: 20px;
  margin-top: 15px;
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  color: var(--gray);
}

.stat-item i {
  color: var(--gold);
}

.awards-section {
  margin-bottom: 40px;
}

.section-title {
  font-size: 24px;
  margin-bottom: 20px;
  color: var(--black);
  font-family: 'Times New Roman', serif;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title i {
  color: var(--gold);
}

.award-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 20px;
}

.award-card {
  background-color: var(--white);
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
  border-left: 4px solid var(--gold);
}

.award-year {
  font-weight: 700;
  color: var(--gold);
  font-size: 18px;
  margin-bottom: 8px;
}

.award-category {
  font-weight: 600;
  font-size: 16px;
  margin-bottom: 5px;
  color: var(--black);
}

.award-work {
  color: var(--gray);
  font-size: 14px;
  margin-bottom: 8px;
}

.award-status {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: 600;
}

/* Loading State */
.loading-container {
  text-align: center;
  padding: 60px 20px;
}

.loading-spinner {
  border: 4px solid rgba(201, 164, 76, 0.2);
  border-radius: 50%;
  border-top: 4px solid var(--gold);
  width: 60px;
  height: 60px;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  font-size: 18px;
  color: var(--gray);
}

/* Error State */
.error-container {
  text-align: center;
  padding: 60px 20px;
  background-color: #fff5f5;
  border-radius: 10px;
  border: 1px solid #fed7d7;
}

.error-icon {
  font-size: 48px;
  color: #e53e3e;
  margin-bottom: 20px;
}

.error-text {
  font-size: 18px;
  color: #c53030;
  margin-bottom: 20px;
}

.retry-button {
  background-color: #e53e3e;
  color: white;
  border: none;
  padding: 12px 25px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--gray);
  font-size: 18px;
}

/* Footer */
footer {
  background-color: var(--dark);
  color: var(--white);
  padding: 30px 20px;
  text-align: center;
  margin-top: 60px;
}

.footer-content {
  max-width: 1200px;
  margin: 0 auto;
}

.footer-links {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 20px 0;
}

.footer-links a {
  color: var(--gold);
  text-decoration: none;
  transition: color 0.3s;
}

.footer-links a:hover {
  color: var(--white);
}

.copyright {
  color: #999;
  font-size: 14px;
  margin-top: 20px;
}

/* Responsive */
@media (max-width: 768px) {
  .header-container {
    flex-direction: column;
    gap: 20px;
  }
  
  nav ul {
    gap: 15px;
  }
  
  .edition-header {
    flex-direction: column;
    gap: 20px;
    align-items: flex-start;
  }
  
  .artist-header {
    flex-direction: column;
    text-align: center;
    gap: 20px;
  }
  
  .artist-stats {
    justify-content: center;
  }
  
  .award-list {
    grid-template-columns: 1fr;
  }
  
  .nominee-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }
  
  .nominee-image {
    margin-right: 0;
  }
  
  .nominee-status {
    margin-left: 0;
    align-self: flex-end;
  }
}
</style>
</head>
<body>
<header>
  <div class="header-container">
    <div class="logo">
      <i class="fas fa-trophy logo-icon"></i>
      <h1>DAEGON AWARDS</h1>
    </div>
    <nav>
      <ul>
        <li><a href="#" id="homeLink" class="active">Home</a></li>
        <li><a href="#" id="aboutLink">About</a></li>
      </ul>
    </nav>
  </div>
</header>

<main>
  <!-- Home Section -->
  <section id="home" class="container">
    <div class="home-header">
      <h2>Daegon Music Awards</h2>
      <p>Celebrating excellence in music across multiple genres and categories. Explore past editions, winners, and nominees.</p>
    </div>
    
    <div class="editions-grid" id="editionsGrid">
      <!-- Edition cards will be populated by JavaScript -->
    </div>
  </section>

  <!-- Edition Section -->
  <section id="edition" class="container hidden">
    <div class="edition-header">
      <h2 id="editionTitle">Daegon Awards</h2>
      <button class="back-button" id="backButton">
        <i class="fas fa-arrow-left"></i> Back to Home
      </button>
    </div>
    
    <div id="editionContent">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading award data...</div>
      </div>
    </div>
  </section>

  <!-- Artist Section -->
  <section id="artist" class="container hidden">
    <div class="edition-header">
      <h2 id="artistTitle">Artist Profile</h2>
      <button class="back-button" id="backButtonArtist">
        <i class="fas fa-arrow-left"></i> Back
      </button>
    </div>
    
    <div id="artistContent">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading artist data...</div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="container hidden">
    <div class="edition-header">
      <h2>About Daegon Awards</h2>
      <button class="back-button" id="backButtonAbout">
        <i class="fas fa-arrow-left"></i> Back to Home
      </button>
    </div>
    
    <div style="max-width: 800px; margin: 0 auto;">
      <div style="margin-bottom: 40px;">
        <h3 style="font-size: 24px; margin-bottom: 15px; color: var(--black);">Our Mission</h3>
        <p style="font-size: 16px; line-height: 1.7; color: var(--gray);">
          The Daegon Awards were established to recognize and celebrate exceptional talent in the music industry. 
          Our goal is to honor artists, producers, and contributors who have made significant impacts through their creative work.
        </p>
      </div>
      
      <div style="margin-bottom: 40px;">
        <h3 style="font-size: 24px; margin-bottom: 15px; color: var(--black);">Selection Process</h3>
        <p style="font-size: 16px; line-height: 1.7; color: var(--gray);">
          Nominees are selected by a panel of industry experts, and winners are chosen based on artistic merit, 
          innovation, and cultural impact. The process is designed to be fair, transparent, and comprehensive.
        </p>
      </div>
      
      <div>
        <h3 style="font-size: 24px; margin-bottom: 15px; color: var(--black);">Data Source</h3>
        <p style="font-size: 16px; line-height: 1.7; color: var(--gray); margin-bottom: 20px;">
          All award data is sourced from publicly available Google Sheets that document the nominations and winners 
          for each edition of the Daegon Awards from 2017 to 2025.
        </p>
        <a href="https://docs.google.com/spreadsheets/d/1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk" 
           target="_blank" 
           style="display: inline-flex; align-items: center; gap: 10px; background-color: var(--gold); color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: 600;">
          <i class="fas fa-external-link-alt"></i> View Data Source
        </a>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="footer-content">
    <div class="logo" style="justify-content: center;">
      <i class="fas fa-trophy logo-icon"></i>
      <h1 style="color: white;">DAEGON AWARDS</h1>
    </div>
    
    <div class="footer-links">
      <a href="#" id="footerHome">Home</a>
      <a href="#" id="footerAbout">About</a>
      <a href="https://docs.google.com/spreadsheets/d/1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk" target="_blank">Data Source</a>
    </div>
    
    <div class="copyright">
      © 2023 Daegon Awards. All data is for demonstration purposes.
    </div>
  </div>
</footer>

<script>
// ================= CONSTANTS AND DATA =================
const EDITIONS = {
  2017: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "0",
    name: "2017 Edition"
  },
  2018: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "912023648",
    name: "2018 Edition"
  },
  2019: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "221365296",
    name: "2019 Edition"
  },
  2020: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "1123138246",
    name: "2020 Edition"
  },
  2021: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "919977085",
    name: "2021 Edition"
  },
  2022: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "2065423547",
    name: "2022 Edition"
  },
  2023: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "1803569858",
    name: "2023 Edition"
  },
  2024: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "1350904783",
    name: "2024 Edition"
  },
  2025: {
    sheetId: "1DNb6uYi6K231-fhrSt3XPlaag8eG9ZFVHhvSXyjWCuk",
    gid: "1189047483",
    name: "2025 Edition"
  }
};

const NO_FEAT_CATEGORIES = ["Artist of the Year", "Best New Artist"];

// Artist image cache
const artistImageCache = {};

// Data cache
const dataCache = {};

// ================= DOM ELEMENTS =================
const homeSection = document.getElementById('home');
const editionSection = document.getElementById('edition');
const artistSection = document.getElementById('artist');
const aboutSection = document.getElementById('about');
const editionContent = document.getElementById('editionContent');
const artistContent = document.getElementById('artistContent');
const editionTitle = document.getElementById('editionTitle');
const artistTitle = document.getElementById('artistTitle');
const editionsGrid = document.getElementById('editionsGrid');

// Navigation links
const homeLink = document.getElementById('homeLink');
const aboutLink = document.getElementById('aboutLink');
const footerHome = document.getElementById('footerHome');
const footerAbout = document.getElementById('footerAbout');

// Back buttons
const backButton = document.getElementById('backButton');
const backButtonArtist = document.getElementById('backButtonArtist');
const backButtonAbout = document.getElementById('backButtonAbout');

// ================= HELPER FUNCTIONS =================
function showSection(section) {
  [homeSection, editionSection, artistSection, aboutSection].forEach(s => {
    s.classList.add('hidden');
  });
  section.classList.remove('hidden');
  
  // Update active nav link
  document.querySelectorAll('nav a').forEach(link => {
    link.classList.remove('active');
  });
  
  if (section === homeSection) {
    homeLink.classList.add('active');
  } else if (section === aboutSection) {
    aboutLink.classList.add('active');
  }
}

function showHome() {
  showSection(homeSection);
}

function showAbout() {
  showSection(aboutSection);
}

function getPlaceholderImage(name) {
  if (!name || name.trim() === '') return 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" viewBox="0 0 150 150"><circle cx="75" cy="75" r="75" fill="#cccccc"/><text x="75" y="85" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="60" font-weight="bold">?</text></svg>';
  
  // Use cached image if available
  if (artistImageCache[name]) {
    return artistImageCache[name];
  }
  
  // Generate initials
  const words = name.split(' ').filter(word => word.length > 0);
  let initials = '';
  
  if (words.length === 1) {
    initials = words[0].substring(0, 2).toUpperCase();
  } else {
    initials = (words[0][0] + words[words.length - 1][0]).toUpperCase();
  }
  
  // Color based on name hash
  const colors = [
    '#c9a44c', '#2c3e50', '#3498db', '#e74c3c', '#2ecc71',
    '#9b59b6', '#1abc9c', '#d35400', '#34495e', '#16a085'
  ];
  
  const hash = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
  const color = colors[hash % colors.length];
  
  // Create SVG placeholder
  const svg = `
    <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" viewBox="0 0 150 150">
      <circle cx="75" cy="75" r="75" fill="${color}"/>
      <text x="75" y="85" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="60" font-weight="bold">
        ${initials}
      </text>
    </svg>`;
  
  const dataUrl = 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg);
  artistImageCache[name] = dataUrl;
  
  return dataUrl;
}

function getArtistImage(artistName) {
  return getPlaceholderImage(artistName);
}

async function fetchSheetData(year) {
  // Check cache first
  const cacheKey = `edition-${year}`;
  if (dataCache[cacheKey]) {
    console.log(`Using cached data for ${year}`);
    return dataCache[cacheKey];
  }
  
  const edition = EDITIONS[year];
  if (!edition) {
    throw new Error(`Edition ${year} not found`);
  }
  
  try {
    console.log(`Fetching data for ${year} edition...`);
    
    // Usando uma abordagem mais direta para Google Sheets
    // O Google Sheets permite CORS para a API de visualização
    const url = `https://docs.google.com/spreadsheets/d/${edition.sheetId}/gviz/tq?tqx=out:json&gid=${edition.gid}`;
    
    const response = await fetch(url, {
      method: 'GET',
      mode: 'cors',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const text = await response.text();
    
    // Parse the response from Google Sheets API
    // The response starts with "/*O_o*/" and then "google.visualization.Query.setResponse("
    const jsonStart = text.indexOf('{');
    const jsonEnd = text.lastIndexOf('}') + 1;
    
    if (jsonStart === -1 || jsonEnd === -1) {
      throw new Error('Invalid response format from Google Sheets');
    }
    
    const jsonText = text.substring(jsonStart, jsonEnd);
    const data = JSON.parse(jsonText);
    
    if (!data.table || !data.table.rows) {
      throw new Error('No data found in response');
    }
    
    // Process the data according to the column structure
    const rows = data.table.rows;
    const categories = {};
    
    // Skip header row (index 0)
    for (let i = 1; i < rows.length; i++) {
      const row = rows[i];
      const cells = row.c;
      
      if (!cells || cells.length < 5) continue;
      
      // Extract data based on column structure:
      // 0: category, 1: item, 2: artist, 3: feature, 4: status
      const category = cells[0]?.v || '';
      const item = cells[1]?.v || '';
      const artist = cells[2]?.v || '';
      const feature = cells[3]?.v || '';
      const status = cells[4]?.v || '';
      
      if (!category || !artist || category.trim() === '' || artist.trim() === '') continue;
      
      if (!categories[category]) {
        categories[category] = [];
      }
      
      categories[category].push({
        item: item || artist, // If no item, use artist name
        artist: artist,
        feature: feature,
        status: status.toLowerCase().includes('win') ? 'Winner' : 'Nominated',
        year: year
      });
    }
    
    // Cache the data
    dataCache[cacheKey] = categories;
    console.log(`Data for ${year} edition loaded successfully. Categories: ${Object.keys(categories).length}, Total entries: ${Object.values(categories).flat().length}`);
    
    return categories;
  } catch (error) {
    console.error(`Error fetching edition ${year}:`, error);
    
    // Fallback: Try with a CORS proxy as backup
    try {
      console.log(`Trying CORS proxy for ${year}...`);
      const proxyUrl = 'https://api.allorigins.win/raw?url=';
      const targetUrl = `https://docs.google.com/spreadsheets/d/${edition.sheetId}/gviz/tq?tqx=out:json&gid=${edition.gid}`;
      
      const proxyResponse = await fetch(proxyUrl + encodeURIComponent(targetUrl));
      
      if (!proxyResponse.ok) {
        throw new Error(`Proxy HTTP error! status: ${proxyResponse.status}`);
      }
      
      const text = await proxyResponse.text();
      
      // Parse the response
      const jsonStart = text.indexOf('{');
      const jsonEnd = text.lastIndexOf('}') + 1;
      
      if (jsonStart === -1 || jsonEnd === -1) {
        throw new Error('Invalid response format from proxy');
      }
      
      const jsonText = text.substring(jsonStart, jsonEnd);
      const data = JSON.parse(jsonText);
      
      if (!data.table || !data.table.rows) {
        throw new Error('No data found in proxy response');
      }
      
      // Process the data
      const rows = data.table.rows;
      const categories = {};
      
      for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        const cells = row.c;
        
        if (!cells || cells.length < 5) continue;
        
        const category = cells[0]?.v || '';
        const item = cells[1]?.v || '';
        const artist = cells[2]?.v || '';
        const feature = cells[3]?.v || '';
        const status = cells[4]?.v || '';
        
        if (!category || !artist || category.trim() === '' || artist.trim() === '') continue;
        
        if (!categories[category]) {
          categories[category] = [];
        }
        
        categories[category].push({
          item: item || artist,
          artist: artist,
          feature: feature,
          status: status.toLowerCase().includes('win') ? 'Winner' : 'Nominated',
          year: year
        });
      }
      
      // Cache the data
      dataCache[cacheKey] = categories;
      console.log(`Data for ${year} edition loaded via proxy. Categories: ${Object.keys(categories).length}`);
      
      return categories;
    } catch (proxyError) {
      console.error(`Proxy also failed for ${year}:`, proxyError);
      throw new Error(`Failed to load data for ${year} edition: ${error.message}`);
    }
  }
}

function renderError(message) {
  return `
    <div class="error-container">
      <div class="error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="error-text">${message}</div>
      <button class="retry-button" onclick="window.location.reload()">
        <i class="fas fa-redo"></i> Retry
      </button>
    </div>
  `;
}

function renderLoading() {
  return `
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading data...</div>
    </div>
  `;
}

// ================= EDITION PAGE =================
async function openEdition(year) {
  showSection(editionSection);
  editionTitle.textContent = `Daegon Awards ${year}`;
  editionContent.innerHTML = renderLoading();
  
  try {
    const categories = await fetchSheetData(year);
    
    if (!categories || Object.keys(categories).length === 0) {
      editionContent.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-trophy" style="font-size: 48px; color: var(--gold); margin-bottom: 20px;"></i>
          <p>No data available for the ${year} edition.</p>
          <p style="font-size: 14px; margin-top: 10px;">The spreadsheet might be empty or have a different format.</p>
        </div>
      `;
      return;
    }
    
    let html = '';
    
    // Sort categories alphabetically
    const sortedCategories = Object.keys(categories).sort();
    
    for (const categoryName of sortedCategories) {
      const nominees = categories[categoryName];
      
      if (!nominees || nominees.length === 0) continue;
      
      // Sort: winners first, then alphabetically by artist
      nominees.sort((a, b) => {
        if (a.status === 'Winner' && b.status !== 'Winner') return -1;
        if (a.status !== 'Winner' && b.status === 'Winner') return 1;
        return a.artist.localeCompare(b.artist);
      });
      
      html += `
        <div class="category-container">
          <div class="category-header">
            <h3>${categoryName}</h3>
          </div>
          <div class="nominees-list">
      `;
      
      for (const nominee of nominees) {
        // Skip entries without artist name
        if (!nominee.artist || nominee.artist.trim() === '') continue;
        
        const isWinner = nominee.status === 'Winner';
        const showFeature = nominee.feature && nominee.feature.trim() !== '' && !NO_FEAT_CATEGORIES.includes(categoryName);
        
        // Display item if different from artist name
        const displayText = nominee.item && nominee.item !== nominee.artist ? 
          `${nominee.item} — ${nominee.artist}` : nominee.artist;
        
        html += `
          <div class="nominee-item ${isWinner ? 'winner' : ''}">
            <img src="${getArtistImage(nominee.artist)}" alt="${nominee.artist}" class="nominee-image">
            <div class="nominee-info">
              <div class="nominee-name">
                <a href="#" onclick="openArtist('${encodeURIComponent(nominee.artist)}'); return false;">
                  ${displayText}
                </a>
              </div>
              ${showFeature ? `<div class="nominee-feature">feat. ${nominee.feature}</div>` : ''}
            </div>
            <div class="nominee-status">
              <span class="status-badge ${isWinner ? 'winner-badge' : 'nominated-badge'}">
                ${isWinner ? 'Winner' : 'Nominated'}
              </span>
            </div>
          </div>
        `;
      }
      
      html += `
          </div>
        </div>
      `;
    }
    
    editionContent.innerHTML = html;
  } catch (error) {
    console.error('Error loading edition:', error);
    editionContent.innerHTML = renderError(`Failed to load award data for ${year}. Please check your connection and try again. Error: ${error.message}`);
  }
}

// ================= ARTIST PAGE =================
async function openArtist(encodedName) {
  const artistName = decodeURIComponent(encodedName);
  showSection(artistSection);
  artistTitle.textContent = artistName;
  artistContent.innerHTML = renderLoading();
  
  try {
    // Fetch data for all editions
    const years = Object.keys(EDITIONS).sort((a, b) => parseInt(b) - parseInt(a)); // Newest first
    const allNominations = [];
    const allEntries = []; // Includes both wins and nominations for counting
    
    for (const year of years) {
      try {
        const categories = await fetchSheetData(year);
        
        for (const [categoryName, nominees] of Object.entries(categories)) {
          if (!nominees) continue;
          
          for (const nominee of nominees) {
            // Skip entries without artist name
            if (!nominee.artist || nominee.artist.trim() === '') continue;
            
            // Check if this artist is the main artist
            const isMainArtist = nominee.artist === artistName;
            
            // Check if this artist is a featured artist
            const isFeaturedArtist = nominee.feature && 
              nominee.feature.split(',').map(f => f.trim()).includes(artistName);
            
            if (isMainArtist || isFeaturedArtist) {
              const entry = {
                year,
                category: categoryName,
                item: nominee.item,
                status: nominee.status,
                role: isMainArtist ? 'Main Artist' : 'Featured Artist'
              };
              
              allEntries.push(entry);
              
              // For wins, add to both wins and nominations
              if (nominee.status === 'Winner') {
                allNominations.push({
                  ...entry,
                  type: 'win'
                });
              }
              
              // Always add to nominations (wins are also nominations)
              allNominations.push({
                ...entry,
                type: 'nomination'
              });
            }
          }
        }
      } catch (error) {
        console.error(`Error fetching data for year ${year}:`, error);
      }
    }
    
    // Remove duplicate nominations (wins appear twice)
    const uniqueNominations = [];
    const seen = new Set();
    
    for (const nom of allNominations) {
      const key = `${nom.year}-${nom.category}-${nom.item}-${nom.role}`;
      if (!seen.has(key)) {
        seen.add(key);
        uniqueNominations.push(nom);
      }
    }
    
    // Separate wins and nominations
    const wins = uniqueNominations.filter(n => n.type === 'win');
    const nominations = uniqueNominations.filter(n => n.type === 'nomination');
    
    // Render artist profile
    let html = `
      <div class="artist-header">
        <img src="${getArtistImage(artistName)}" alt="${artistName}" class="artist-image">
        <div class="artist-details">
          <h2>${artistName}</h2>
          <div class="artist-stats">
            <div class="stat-item">
              <i class="fas fa-trophy"></i>
              <span>${wins.length} Wins</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-star"></i>
              <span>${uniqueNominations.length} Nominations</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-calendar-alt"></i>
              <span>${new Set(allEntries.map(n => n.year)).size} Editions</span>
            </div>
          </div>
        </div>
      </div>
    `;
    
    // Render wins
    html += `
      <div class="awards-section">
        <div class="section-title">
          <i class="fas fa-trophy"></i>
          <span>Award Wins (${wins.length})</span>
        </div>
    `;
    
    if (wins.length > 0) {
      // Group wins by year
      const winsByYear = {};
      wins.forEach(win => {
        if (!winsByYear[win.year]) {
          winsByYear[win.year] = [];
        }
        winsByYear[win.year].push(win);
      });
      
      // Sort years in descending order
      const sortedYears = Object.keys(winsByYear).sort((a, b) => parseInt(b) - parseInt(a));
      
      html += '<div class="award-list">';
      
      for (const year of sortedYears) {
        winsByYear[year].forEach(win => {
          const displayItem = win.item && win.item !== artistName ? win.item : '';
          
          html += `
            <div class="award-card">
              <div class="award-year">${win.year}</div>
              <div class="award-category">${win.category}</div>
              ${displayItem ? `<div class="award-work">${displayItem}</div>` : ''}
              <div>
                <span class="award-status" style="background-color: var(--gold); color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">
                  Winner • ${win.role}
                </span>
              </div>
            </div>
          `;
        });
      }
      
      html += '</div>';
    } else {
      html += `
        <div class="empty-state">
          <p>No wins recorded for ${artistName}.</p>
        </div>
      `;
    }
    
    html += `</div>`;
    
    // Render nominations (including wins)
    html += `
      <div class="awards-section">
        <div class="section-title">
          <i class="fas fa-star"></i>
          <span>All Nominations (${uniqueNominations.length})</span>
        </div>
    `;
    
    if (uniqueNominations.length > 0) {
      // Group nominations by year
      const nominationsByYear = {};
      uniqueNominations.forEach(nomination => {
        if (!nominationsByYear[nomination.year]) {
          nominationsByYear[nomination.year] = [];
        }
        nominationsByYear[nomination.year].push(nomination);
      });
      
      // Sort years in descending order
      const sortedYears = Object.keys(nominationsByYear).sort((a, b) => parseInt(b) - parseInt(a));
      
      html += '<div class="award-list">';
      
      for (const year of sortedYears) {
        nominationsByYear[year].forEach(nomination => {
          const displayItem = nomination.item && nomination.item !== artistName ? nomination.item : '';
          const isWin = nomination.type === 'win';
          
          html += `
            <div class="award-card">
              <div class="award-year">${nomination.year}</div>
              <div class="award-category">${nomination.category}</div>
              ${displayItem ? `<div class="award-work">${displayItem}</div>` : ''}
              <div>
                <span class="award-status" style="background-color: ${isWin ? 'var(--gold)' : 'var(--light-gray)'}; color: ${isWin ? 'white' : 'var(--gray)'}; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">
                  ${isWin ? 'Winner' : 'Nominated'} • ${nomination.role}
                </span>
              </div>
            </div>
          `;
        });
      }
      
      html += '</div>';
    } else {
      html += `
        <div class="empty-state">
          <p>No nominations recorded for ${artistName}.</p>
        </div>
      `;
    }
    
    html += `</div>`;
    
    artistContent.innerHTML = html;
  } catch (error) {
    console.error('Error loading artist data:', error);
    artistContent.innerHTML = renderError('Failed to load artist data. Please try again. Error: ' + error.message);
  }
}

// ================= INITIALIZE EDITION CARDS =================
function initializeEditionCards() {
  const years = Object.keys(EDITIONS).sort((a, b) => parseInt(b) - parseInt(a));
  
  let html = '';
  years.forEach(year => {
    html += `
      <div class="edition-card" data-year="${year}">
        <div class="edition-year">${year}</div>
        <div class="edition-label">EDITION</div>
      </div>
    `;
  });
  
  editionsGrid.innerHTML = html;
  
  // Add event listeners to edition cards
  document.querySelectorAll('.edition-card').forEach(card => {
    card.addEventListener('click', () => {
      const year = card.getAttribute('data-year');
      openEdition(year);
    });
  });
}

// ================= EVENT LISTENERS =================
document.addEventListener('DOMContentLoaded', () => {
  // Initialize edition cards
  initializeEditionCards();
  
  // Navigation
  homeLink.addEventListener('click', (e) => {
    e.preventDefault();
    showHome();
  });
  
  aboutLink.addEventListener('click', (e) => {
    e.preventDefault();
    showAbout();
  });
  
  footerHome.addEventListener('click', (e) => {
    e.preventDefault();
    showHome();
  });
  
  footerAbout.addEventListener('click', (e) => {
    e.preventDefault();
    showAbout();
  });
  
  // Back buttons
  backButton.addEventListener('click', showHome);
  backButtonArtist.addEventListener('click', () => {
    // Go back to the last viewed edition or home
    const yearMatch = editionTitle.textContent.match(/\d{4}/);
    if (yearMatch && EDITIONS[yearMatch[0]]) {
      openEdition(yearMatch[0]);
    } else {
      showHome();
    }
  });
  
  backButtonAbout.addEventListener('click', showHome);
  
  // Initialize
  showHome();
  
  // Test one edition to see if data loads
  console.log('Daegon Awards initialized. Testing data fetch...');
  
  // Test fetch for 2023 to see if it works
  setTimeout(() => {
    fetchSheetData(2023).then(data => {
      console.log('Test fetch successful for 2023:', data ? `${Object.keys(data).length} categories loaded` : 'No data');
    }).catch(err => {
      console.warn('Test fetch failed for 2023:', err.message);
    });
  }, 1000);
});
</script>
</body>
</html>
